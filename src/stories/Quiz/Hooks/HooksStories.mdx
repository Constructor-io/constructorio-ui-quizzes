import { Meta, Controls } from '@storybook/blocks';
import * as HooksStories from './HooksStories.stories';
import { Markdown } from '@storybook/blocks';
import { BasicUsage } from '../Component/index.stories';
import * as ComponentStories from './HooksStories.stories';

<Meta of={ComponentStories} />{' '}

## `useCioQuiz`
Hook takes args as a parameter and returning props giving you complete control over your UI.
```jsx
const { } = useCioQuiz(args);
```

##### Usage Code Examples
- [example](#usage-example)
##### Props passed to useCioQuiz
- [args](#args)
##### Returned from useCioQuiz
- [state](#state)
- [events](#events)
- [cioClient](#cioclient)
- [primaryColorStyles](#primaryColorStyles)
- [prop getters](#getopentextinputprops)
  - [Quiz questions prop getters](#quiz-questions-prop-getters)
    - [getOpenTextInputProps](#getopentextinputprops)
    - [getSelectInputProps](#getselectinputprops)
    - [getNextQuestionButtonProps](#getnextquestionbuttonprops)
    - [getPreviousQuestionButtonProps](#getpreviousquestionbuttonprops)
    - [getQuizImageProps](#getquizimageprops)
  - [Quiz results prop getters](#quiz-results-prop-getters)
    - [getAddToCartButtonProps](#getaddtocartbuttonprops)
    - [getAddToFavoritesButtonProps](#getaddtofavoritesbuttonprops)
    - [getQuizResultButtonProps](#getquizresultbuttonprops)
    - [getQuizResultLinkProps](#getquizresultlinkprops)
    - [getHydrateQuizButtonProps](#gethydratequizbuttonprops)

<hr />

### Args
<Controls of={BasicUsage} />

<hr />

{/* -------- STATE -------- */}
### `state`

This is quiz state. This includes quiz answers and info.

```jsx
const { state } = useCioQuiz(args);
```

Properties on state:

`answers`: Is the user entered/selected answers including:
<Markdown>
{`
| property          | type                                                          | description                                     |
| :---------------- | :----------------------------------                           | :-------------------------------------------    |
| \`inputs\`        | \`[key: string]: {type: string , value: string | string[];}\` | Is the user entered/selected answers inputs     |
| \`isLastAnswer\`  | Boolean                                                       | whether it's the last question                  |

`}
</Markdown>
`quiz`: Quiz info including:
<Markdown>
{`
| property                          | type                                    | description                          |
| :---------------------------------| :---------------------------------------| :------------------------------------|
| \`currentQuestion\`               | Object                                  | The current question in the quiz.    |
| \`results\`                       | Object                                  | The quiz results                     |
| \`requestState\`                  | \`'STALE'|'LOADING'|'SUCCESS'|'ERROR'\` | The API request state                |
| \`versionId\`                     | string                                  | The quiz version                     |
| \`sessionId\`                     | string                                  | The quiz session                     |
| \`selectedOptionsWithAttributes\` | string[]                                | The selected options with attributes |
`}
</Markdown>

<hr />

{/* -------- EVENTS -------- */}
### `events`

Events to call to trigger constructor events and quiz actions.

```jsx
const { events } = useCioQuiz(args);
```
<Markdown>
{`
| property                          | type                                                       | description                                         |
| :---------------------| :----------------------------------------------------------------------| :---------------------------------------------------|
| \`nextQuestion\`      | \`function() => void\`                                                 | Action event to go to the next question in the quiz|
| \`previousQuestion\`  | \`function() => void\`                                                 | Action event to go to the previous question in the quiz|
| \`resetQuiz\`         | \`function() => void\`                                                 | Action event to go to the reset the quiz state and go to the first question|
| \`resultClick\`       | \`function(item) => void\` item* is the quiz result data)              | Action event to trigger quiz result click events|
| \`addToCart\`         | \`function(e: React.MouseEvent<HTMLElement>, item, price) => void\`    | Action event to trigger add to cart click events|
| \`addToFavorites\`    | \`function(e: React.MouseEvent<HTMLElement>, item, price) => void\`    | Action event trigger add to favorites click events|
| \`hydrateQuiz\`       | \`function() => void\`                                                 | Action event to hydrate the quiz with saved state in session storage on reload|
| \`quizAnswerChanged\` | \`function(payload: string | string[] ) => void\`                      | Action event to trigger add to cart click events|
`}
</Markdown>

{/* -------- CIO CLIENT -------- */}
<hr />
### `cioClient`
Constructor IO client instance.

```jsx
const { cioClient } = useCioQuiz(args);
```

{/* -------- primaryColorStyles -------- */}
<hr />
### `primaryColorStyles`
HSL values of primary theme colors.

```jsx
const { primaryColorStyles } = useCioQuiz(args);
```

<Markdown>
{`
| property              | type        | description                             |
| :---------------------| :-----------| :------------------------------         |
| \`--primary-color-h\` | \`string\`  | Hue value of hsl() color function       |
| \`--primary-color-s\` | \`string\`  | Saturation value of hsl() color function|
| \`--primary-color-l\` | \`string\`  | Lightness value of hsl() color function |
`}
</Markdown>

{/* -------- PROPS GETTERS -------- */}
<hr />
## Prop getters
## Quiz questions prop getters

### `getOpenTextInputProps`

This method should be applied to an input `<input>` on quiz questions of type OpenText.

This handles input state, events and styles.

```jsx
const { getOpenTextInputProps } = useCioQuiz(args);

const ui = (
  /* input */
  <input {...getOpenTextInputProps()} />
);
```

### `getSelectInputProps`

This method should be applied to an element of type `<li>` or `<dev>` on quiz questions of type SelectQuestion.

This handles selection state, events and styles.

It is required to pass an `option` to `getSelectInputProps` in order to be applied.

- `option`: this is the select question option data that will be selected when the user
  selects a particular option.

```jsx
const { getSelectInputProps, state } = useCioQuiz(args);
const currentQuestionData = state.quiz?.currentQuestion?.next_question;

const ui = (
  <div>
    {currentQuestionData.options.map((option) => (
      <div {...getSelectInputProps(option)}>
        <div className='cio-question-option-value'>{option.value}</div>
      </div>
    ))}
  </div>
);
```

### `getNextQuestionButtonProps`

This method should be applied to an element of type `<button>` or `<div>` on any quiz question.

This handles traversing the questions. Next action.

```jsx
const { getNextQuestionButtonProps } = useCioQuiz(args);

const ui = (
  /* button, dev, ... */
  <button {...getNextQuestionButtonProps()}>Continue</button>
);
```

### `getPreviousQuestionButtonProps`

This method should be applied to an element of type `<button>` or `<div>` on quiz.

This handles resetting the quiz state and going back to the first question of the quiz.

```jsx
const { getResetQuizButtonProps } = useCioQuiz(args);

const ui = (
  /* button, dev, ... */
  <button {...getResetQuizButtonProps()}>Reset Quiz</button>
);
```

### `getQuizImageProps`

This method should be applied to an element of type `<image>` or `<div>` on quiz images of any question type.

```jsx
const { getQuizImageProps } = useCioQuiz(args);

const ui = (
  <img {...getQuizImageProps()} className='cio-question-image' />
);
```

## Quiz results prop getters

### `getAddToCartButtonProps`

This method should be applied to an element of type `<button>` or `<div>` on quiz results page on quiz result item.

It is required to pass an `item` and `price` to `getAddToCartButtonProps` in order to apply the logic and tracking.

- `item`: this is the result item of the quiz that will be selected to be tracked when the user
  clicks Add to cart button.
- `price`: this is the price of the result that will be sent with the tracking event.

```jsx
const { getAddToCartButtonProps } = useCioQuiz(args);

const ui = (
  /* button, dev, ... */
  <button {...getAddToCartButtonProps(item, price)}>Add to Cart</button>
);
```

### `getAddToFavoritesButtonProps`

This method should be applied to an element of type `<button>` or `<div>` on any quiz question.

This handles traversing the questions. Back action.

It is required to pass an `item` and `price` to `getAddToFavoritesButtonProps` in order to apply the logic and tracking.

- `item`: this is the result item of the quiz that will be selected to be tracked when the user
  clicks Add to favorites button.
- `price`: this is the price of the result that will be sent with the tracking event.

```jsx
const { getAddToFavoritesButtonProps } = useCioQuiz(args);

const ui = (
  /* button, dev, ... */
  <button {...getAddToCartButtonProps(item, price)}>Add to favorites</button>
);
```

### `getQuizResultButtonProps`

This method should be applied to a product card container of type `<div>` on quiz results page.

This handles href, events, and tracking.

It is required to pass an `item` and `position` to `getQuizResultButtonProps` in order to apply the logic and tracking.

- `item`: this is the result item of the quiz that will be selected to be tracked when the user
  clicks on it.
- `position`: this is the position of the item that will be sent with the tracking event.

```jsx
const { getQuizResultButtonProps, state } = useCioQuiz(args);
const quizResults = state.quiz.results?.response?.results;

const ui = (
  <div>
    {quizResults.map((item, i) => (
      <div
        {...getQuizResultButtonProps({
          result,
          position: i,
        })}>
        <p>{item.value}</p>
      </div>
    ))}
  </div>
);
```

### `getQuizResultLinkProps`

This method should be applied to a product card container of type link `<a>` on quiz results page.

This handles href, events, and tracking.

It is required to pass an `item` and `position` to `getQuizResultLinkProps` in order to apply the logic and tracking.

- `item`: this is the result item of the quiz that will be selected to be tracked when the user
  clicks on it.
- `position`: this is the position of the item that will be sent with the tracking event.

```jsx
const { getQuizResultLinkProps, state } = useCioQuiz(args);
const quizResults = state.quiz.results?.response?.results;

const ui = (
  <div>
    {quizResults.map((item, i) => (
      <a
        {...getQuizResultLinkProps({
          result,
          position: i,
        })}>
        <p>{item.value}</p>
      </a>
    ))}
  </div>
);
```

### `getHydrateQuizButtonProps`
This method should be applied to an element of type `<button>` or `<div>` to hydrate the quiz with saved state between reloads.

```jsx
const { getHydrateQuizButtonProps } = useCioQuiz(args);

const ui = (
  <button {...getHydrateQuizButtonProps()}>Hydrate quiz</button>
);
```

{/* -------- USAGE EXAMPLE -------- */}
<hr />
<details open>

<summary><Markdown>{`### Usage Example`}</Markdown></summary>
```jsx
 const {
    state,
    getOpenTextInputProps,
    getNextQuestionButtonProps,
    getPreviousQuestionButtonProps,
    getQuizImageProps,
    getSelectQuestionImageProps,
    getSelectInputProps,
    getResetQuizButtonProps,
    getQuizResultButtonProps,
    getAddToCartButtonProps,
  } = useCioQuiz(args);

  if (state.quiz.requestState === 'SUCCESS') {
    const quizResults = state.quiz.results?.response?.results;
    const zeroResults = !quizResults?.length;

    // Quiz Results
    if (quizResults) {
      return (
        <div className='cio-quiz'>
          <div className='cio-results-container'>
            <h1 className='cio-results-title'>Results</h1>
            <div className='cio-results-filter-and-redo-container'>
              <div className='cio-results-filter-container'>
                <p>Because you answered</p>
                <div className='cio-results-filter-options'>
                  {state?.quiz.selectedOptionsWithAttributes?.map((option) => (
                    <div className='cio-results-filter-option' key={option}>
                      {option}
                    </div>
                  ))}
                </div>
              </div>
              <button {...getResetQuizButtonProps('secondary')}>
                <RedoSVG />
                <span>retake</span>
              </button>
            </div>
            <div className='cio-results'>
              {!zeroResults &&
                quizResults.map((result, i) => (
                  <div className='cio-result-card'>
                    <div
                      {...getQuizResultButtonProps({
                        result,
                        position: i,
                      })}>
                      <div className='cio-result-card-image'>
                        <img src={result.data?.image_url} alt='product' />
                      </div>
                      <div className='cio-result-card-text'>
                        <p className='cio-result-card-title'>{result.value}</p>
                        <div className='cio-result-card-prices'>
                          {result?.data?.price && (
                            <span className='cio-result-card-sale-price'>${result.data.price}</span>
                          )}
                          {result?.data?.price && (
                            <span
                              className={`cio-result-card-regular-price${
                                result.data.price ? '--strike-through' : ''
                              }`}>
                              ${result.data.price}
                            </span>
                          )}
                        </div>
                      </div>
                      <button {...getAddToCartButtonProps(result, result?.data?.price)}>
                        Add to Cart
                      </button>
                    </div>
                  </div>
                ))}
            </div>

            {zeroResults && (
              <div className='cio-zero-results'>
                <h3 className='cio-zero-results-subtitle'>
                  Sorry, we couldn’t find products that perfectly match your preferences.
                </h3>
                <div className='cio-button-container'>
                  <button {...getResetQuizButtonProps()}>Try Again</button>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    const { currentQuestion } = state.quiz;
    const currentQuestionData = currentQuestion?.next_question;
    if (currentQuestionData) {
      // Open Text Question
      if (currentQuestion.isOpenQuestion) {
        return (
          <div className='cio-quiz'>
            <div className='cio-container--with-image cio-open-text-question-container--with-image'>
              {currentQuestionData.images?.primary_url && (
                <span className='cio-question-image-container'>
                  <img {...getQuizImageProps()} className='cio-question-image' />
                </span>
              )}
              <div className='cio-question-content'>
                <h1 className='cio-question-title'>{currentQuestionData.title}</h1>
                <p className='cio-question-description'>{currentQuestionData.description}</p>
                <input {...getOpenTextInputProps()} />
                <div className='cio-question-buttons-container'>
                  <button {...getPreviousQuestionButtonProps()}>Back</button>
                  <div className='cio-button-container'>
                    <button {...getNextQuestionButtonProps()}>Continue</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Cover Question
      if (currentQuestion.isCoverQuestion) {
        return (
          <div className='cio-quiz'>
            <div className='cio-container--with-image cio-cover-question-container--with-image'>
              {currentQuestionData.images?.primary_url && (
                <span className='cio-question-image-container'>
                  <img {...getQuizImageProps()} className='cio-question-image' />
                </span>
              )}
              <div className='cio-question-content'>
                <h1 className='cio-question-title'>{currentQuestionData.title}</h1>
                <p className='cio-question-description'>{currentQuestionData.description}</p>
                <div className='cio-question-buttons-container'>
                  <button {...getPreviousQuestionButtonProps()}>Back</button>
                  <div className='cio-button-container'>
                    <button {...getNextQuestionButtonProps()}>Continue</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Select Question
      if (currentQuestion.isSelectQuestion) {
        return (
          <div className='cio-quiz'>
            <div className='cio-select-question-container'>
              <div className='cio-select-question-text'>
                <h1>{currentQuestionData.title}</h1>
                <p>{currentQuestionData.description}</p>
              </div>
              <div className='cio-question-options-container'>
                {currentQuestionData.options.map((option: QuestionOption) => (
                  <div {...getSelectInputProps(option)}>
                    {option.images ? <img {...getSelectQuestionImageProps(option)} /> : ''}
                    <div className='cio-question-option-value'>{option.value}</div>
                  </div>
                ))}
              </div>

              <div className='cio-question-buttons-container'>
                <button {...getPreviousQuestionButtonProps()}>Back</button>
                <div className='cio-button-container'>
                  <button {...getNextQuestionButtonProps()}>Continue</button>
                </div>
              </div>
            </div>
          </div>
        );
      }
    }
  }
  return null;
```
</details>

